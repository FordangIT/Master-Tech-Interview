## 동기화 문제

**동기화:**한정적인 시스템 자원에 여러 스레드가 동시에 접근할 때 발생하는 문제를 방지하기 위해서, 여러 스레드에게 하나의 자원에 대한 처리 권한을 부여 하거나 순서를 조정하는 기법이다.

### 스레드 동기화

**1. 실행 순서의 동기화** : 스레드의 실행 순서를 정의하고, 반드시 그 순서를 따르도록 하는 것.
**2. 메모리 접근에 대한 동기화**

- 메모리 접근 시 동시 접근을 막는 것.
- 실행 순서보다는 한 순간에 하나의 스레드만 해당 자원에 접근하도록 하는 것이 중요.

### 동기화 기법

**1. 유저 모드의 동기화**

- 커널의 도움없이 이루어지는 동기화 기법
- 성능상의 이점이 있으나 기능상의 제한이 있다.
- ex) 임계 구역 기반의 동기화, 인터락 함수 기반의 동기화.

#### 1) 임계 구역 기반의 동기화

- 열쇠를 얻은 프로세스만 임계 구역에 들어갈 수 있다. 즉, 한번에 하나의 스레드만이 접근 가능하다.
- 임계 구역 진입을 위해 `critical section object`를 획득한다.
- 다른 스레드가 열쇠를 가지고 있을 경우, 반환될 때까지 해당 스레드는 blocking 상태가 된다. 열쇠가 반환되면 blocking 상태에서 벗어나 열쇠를 얻고 임계 구역에 접근할 수 있다.

#### 2) 인터락 함수 기반의 동기화 (Interlocked Functions)

- 함수 내부적으로 한 순간에 하나의 스레드만 실행되도록 동기화한다.
- 임계 구역 기반의 동기화도 내부적으로 인터락 함수를 기반으로 구현된다.
- 유저 모드에서 동작하므로 속도가 빠르다.

**2. 커널 모드의 동기화**

- 커널에서 제공하는 동기화 기능을 이용하는 방법.
- 커널 모드로의 전환이 필요해 성능 저하가 있을 수 있으나 다양한 기능을 활용할 수 있다.
- ex) 세마포어, 뮤텍스, 모니터 등등.

#### 1) 세마포어(Semaphore)

- 공유된 자원에 여러 프로세스나 스레드가 동시에 접근하는 것을 막는 기법.
- 동시에 접근할 수 있는 '허용 가능한 개수'를 가지는 카운터 역할을 한다. 이 카운터는 공유 자원에 접근할 수 있는 스레드 또는 프로세스의 수를 나타낸다.
- ex) 화장실
  : 세마포어는 여러 개의 열쇠로 비유할 수 있다. 화장실 칸이 4개 있고, 열쇠가 4개라면, 4명까지는 대기없이 사용할 수 있다. 이후에는 대기를 해야 한다.
- Semaphore Counter 개수에 따라 두가지로 나뉜다.
  - 1개: Binary Semaphore(뮤텍스와 유사)
  - 2개이상: Counting Semaphore
- Semaphore는 소유할 수 없다.
  - 세마포어를 소유하지 않은 스레드가 세마포어를 해제할 수 있는 문제가 발생할 수 있다.

세마포어는 운영체제나 다중 스레드 환경에서 중요한 동기화 도구로 사용된다. 세마포어를 통해 자원 접근을 제어함으로써 교착 상태(데드락)와 같은 문제를 예방할 수 있다. Binary Semaphore는 주로 상호 배제를 위해 사용되며, Counting Semaphore는 제한된 자원에 대한 접근을 관리하는데 유용하다.

#### 2) 뮤텍스

: 뮤텍스()는 여러 프로세스나 스레드가 동시에 공유 자원에 접근하는 것을 방지하기 위해 사용되는 동기화 매커니즘이다. 뮤텍스를 이용하면 데이터 일관성을 유지하고 경합 상태를 피할 수 있다.

**1. 공유 자원 접근 제어**

- 여러 프로세스나 스레드가 공유 자원에 동시 접근하지 못하게 막는다.
- 자원에 대한 동시 접근을 제어하며 데이터 일관성을 유지한다.

**2. 임계 구역 보호**

- 임계 구역은 동시에 하나의 프로세스나 스레드만 접근할 수 있는 코드 영역이다.
- 뮤텍스는 임계 구역을 가진 스레드들이 서로 겹치지 않고 단독으로 실행되도록 보장한다.

**3. 단일 접근 원칙**

- 뮤텍스 객체는 두 스레드가 사용할 수 없다.
- 오직 하나의 스레드만 뮤텍스를 획득(lock)하고, 나머지 스레드는 뮤텍스가 해제(unlock)될 때까지 대기한다.

**4. Locking 매터니즘**

- 뮤텍스는 잠금과 해제 매커니즘을 통해 공유 자원에 대한 접근을 조율한다.
- 스레드는 자원에 접근하기 전에 뮤텍스를 획득하고, 자원 사용 후에는 뮤텍스를 해제한다.

**5. Lock 소유권**

- 뮤텍스는 소유권이 있으며, 뮤텍스를 획득한 스레드만이 공유자원에 접근할 수 있다.
- 또한, 뮤텍스를 획득한 스레드만이 뮤텍스를 해제할 수 있다.

**6. 단일 열쇠 원칙**

- 뮤텍스는 항상 하나의 열쇠만 가질 수 있다.
- 여러 스레드가 하나의 뮤텍스를 공유하는 경우, 동시에 하나의 스레드만이 뮤텍스를 획득할 수 있다.

- 공유된 자원의 데이터를 여러 프로세스, 스레드가 접근하는 것을 막는다.
- 임계 구역을 가진 스레드들의 Running time이 서로 겹치지 않게 가각단독으로 실행하게 하는 기술이다.
- 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.
- 일종의 Locking 매커니즘으로 공유 자원에 대한 접근을 조율하기 위해 locking과 unlocking을 사용한다.
- Lock에 대한 소유권이 있으며 Lock을 가지고 있을 경우에만 공유 자원에 접근할 수 있고, Lock을 가진 사람만 반납할 수 있따.
- 뮤텍스는 무조건 1개의 열쇠만 가질 수 있다.

#### 3) 모니터
