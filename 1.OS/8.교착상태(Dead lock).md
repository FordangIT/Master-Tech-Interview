# 교착 상태 (DeadLock)

## 정의

- 한정된 자원을 여러 프로세스가 사용하려고 할 때 발생하는 문제이다.
- 즉, 프로세스가 필요한 자원을 얻지 못해서 다음 처리를 하지 못하는 상태이다.

## 예시 (그림참고)

프로세스 1과 프로세스 2가 모두 자원 1, 자원 2를 얻어야 한다고 가정해보자.

t1: 프로세스 1이 자원 1을 얻음/ 프로세스 2가 자원2를 얻음.
t2: 프로세스 1은 자원 2를 기다림/ 프로세스 2는 자원 1 을 기다림

현재 서로 원하는 자원이 상대방에게 할당되어 있어서 두 프로세스는 무한정 wait 상태에 빠지게 된다.
=> `DeadLock`

## 발생 조건

- 교착 상태가 발생하기 위해서는 네가지 조건이 모두 만족되어야 한다.
  **1. 상호배제 (Mutual Exclusion)**
  : 자원은 한번에 한 프로세스만 사용할 수 있어야 한다.
  **2. 점유와 대기 (Hold and Wait)**
  :최소한 하나의 자원을 점유하고 있는 프로세스가 다른 프로세스에 할당되어 사용하고 있는 자원을 추가적으로 요구하며 대기해야 한다.
  **3. 비선점 (No Preemption)**
  : 다른 프로세스에 할당된 자원을 강제로 빼앗을 수 없어야 한다.  
  **4. 순환 대기 (Circular Wait)**
  : 자원을 기다리는 프로세스들이 원형으로 연결되어 있어야 한다.

## 주로 발생하는 경우

- **한정된 자원 경쟁**: 멀티 프로그래밍 환경에서 여러 프로세스가 한정된 자원을 얻기 위해 경쟁한다. 예를 들어, 프린터, 파일, 데이터베이스와 같은 자원이 동시에 여러 프로세스에 의해 사용될 수 없는 경우, 자원 경쟁이 발생한다.
- **자원 요청과 대기**: 프로세스가 자원을 요청할 때 해당 자원이 이미 다른 프로세스에 의해 사용 중이라면, 해당 프로세스는 대기 상태로 들어간다. 이때, 대기 중인 프로세스는 요청한 자원이 해제되기를 기다린다.

## 교착 상태 처리

### 1. 교착 상태 예방

- 시스템이 교착 상태에 빠지지 않도록 사전에 조치를 취하는 방법이다.
- 교착 상태가 발생하는 4가지 조건 중 하나를 제거하여 해결한다.
- 자원의 낭비가 심할 수 있다는 단점이 있지만, 확실한 예방책이다.

**1.상호 배제 부정**
**설명**: 상호 배제는 자원이 한번에 하나의 프로세스만 사용할 수 있는 조건이다.

**해결방법**: 여러 프로세스가 동시에 자원을 공유할 수 있도록 한다. 예를 들어, 읽기 전용 자원에 대해 여러 프로세스가 동시에 접근할 수 있도록 허용한다.

**단점**: 일부 자원은 본질적으로 상호 배제를 필요로 하기 때문에 완전히 제거하기 어렵다.

**2.점유 대기 부정**
**설명**: 점유 대기는 프로세스가 이미 자원을 점유하고 있는 상태에서 추가 자원을 요청하며 대기하는 조건이다.
**해결 방법**: 프로세스가 실행되기 전에 필요한 모든 자원을 한 번에 할당한다. 이렇게 하면 실행 중인 프로세스는 추가 자원을 요청할 필요가 없다.
**단점**: 자원이 비효율적으로 사용될 수 있으며, 다른 프로세스가 필요한 자원을 오랫동안 점유할 수 있다.

**3.비선점 부정**
**설명**: 비선점은 프로세스가 자원을 점유한 상태에서 강제로 빼앗기지 않는 조건이다.
**해결 방법**: 프로세스가 다른 자원을 요구할 때, 이미 점유 중인 자원을 반납하도록 한다. 이후 필요한 자원을 사용할 수 있게 되면 다시 요청할 수 있다.
**단점**: 자원을 반납하는 과정에서 작업이 중단될 수 있으며, 다시 자원을 할당받을 때까지 대기해야 하는 비효율이 발생할 수 있다.

**4. 순환 대기 부정**
**설명**: 순환 대기는 프로세스들이 서로의 자원을 기다리며 순환적으로 대기하는 조건이다.
**해결 방법**: 자원에 고유한 번호를 할당하고, 프로세스가 자원을 요청할 때 항상 증가하는 순서대로 자원을 요청하도록 한다. 예를 들어, 프로세스가 자원 1을 점유한 상태에서 자원 2 를 요청할 수 있지만, 반대로 자원 2 를 점유한 상태에서 자원 1 을 요청할 수 없다.
**단점**: 자원 요청 순서를 정하는 데 추가적인 관리와 복잡성이 필요할 수 있다.

#### 교착 상태 예방의 단점

**자원 낭비**: 필요한 모든 자원을 미리 할당하는 방법은 자원의 비효율적 사용을 초래할 수 있다.  
**복잡성 증가**: 자원 번호를 할당하고 순서대로 요청하게 하는 등의 방법은 시스템의 복잡성을 증가시킬 수 있다.
**프로세스 지연**: 자원을 반납하고 다시 요청하는 과정에서 프로세스가 지연될 수 있다.

### 2. 교착 상태 회피

: 교착 상태 회피는 교착 상태를 사전에 피할 수 있도록 하는 기법으로, 프로세스가 자원을 요구할 때 시스템이 현재 상태와 자원 요청을 검토하여 교착 상태로 이어질 가능성이 있는지 판단하는 방식이다. 가장 대표적인 방법으로는 다익스트라가 제안한 `은행원 알고리즘`이 있다.

#### 은행원 알고리즘

**개요**

- 은행가 알고리즘은 은행에서 모든 고객의 요구를 충족하도록 현금을 할당하는 데서 유래한 기법이다.
- 시스템은 자원을 할당하기 전에 자원 할당 후에도 시스템이 안전 상태로 남아 있는지를 검사한다.

**안전 상태**

- 시스템이 어떤 프로세스에 자원을 할당한 후에도 교착 상태 없이 모든 프로세스가 완료될 수 있는 상태를 말한다.
- 안전 상태에서는 어떤 순서로든 프로세스가 자원을 획득하고 작업을 완료한 후 자원을 해제할 수 있다. 키

#### 은행원 알고리즘 동작 원리

**1. 자원 상태 정보 유지**:

- 시스템은 현재 자원 상태, 각 프로세스의 최대 요구량, 이미 할당된 자원, 그리고 아직 필요한 자원 정보를 유지한다.
  **2. 자원 요청 시 검사**:
- 프로세스가 자원을 요청하면 시스템은 이 시스템이 안전 상태로 유지될 수 있는지를 검토한다.
  **3. 안전성 검사**:
- 자원을 할당한 후에도 시스템이 안전 상태로 남아 있는지 확인한다. 이를 위해 가상의 자원 할당을 수행한 후, 모든 프로세스가 순서대로 완료될 수 있는지를 검사한다.
- 만약 자원 할당 후에도 안전 상태가 유지되면 자원을 실제로 할당한다.
- 그렇지 않으면 해당 프로세스의 자원 요청을 거부하거나 대기시킨다.

#### 교착 상태 회피의 장점과 단점

**장점**:

- 교착 상태가 발생하지 않도록 사전에 방지할 수 있다.
- 자원의 효율적인 사용이 가능하다.
  **단점**:
- 모든 자원 상태와 요구를 지속적으로 추적하고 계산해야 하므로 오버헤드가 발생할 수 있다.
- 시스템의 복잡성이 증가하며, 프로세스의 자원 요구량을 사전에 정확히 알아야 한다.
