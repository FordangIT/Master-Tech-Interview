# 인터럽트 (Interrupt)

: 인터럽트는 하드웨어 장치가 cpu에게 특정 사실을 알리거나 cpu의 서비스를 요청할 때 사용되는 메커니즘이다. 인터럽트는 cpu의 인터럽트 라인을 세팅하여 발생하며, 이를 통해 cpu가 즉각적으로 특정 작업을 수행할 수 있도록 한다.

## 인터럽트 처리 과정

**1. 인터럽트 발생**: 하드웨어 장치가 cpu에게 알리거나 요청할 필요가 있을 때 cpu 내의 인터럽트 라인을 세팅하여 인터럽트를 발생시킨다.
**2. 인터럽트 체크**: cpu는 매번 pc(program counter)가 가리키는 명령을 수행한 뒤, 다음 명령을 수행하기 직전에 인터럽트 라인이 세팅되어 있는지 확인한다.
**3. 인터럽트 처리 루틴 이동**:인터럽트가 발생한 경우, cpu는 현재 수행 중이던 프로세스를 멈추고 운영체제의 인터럽트 처리 루틴으로 이동한다.
**4. 인터럽트 처리**: 인터럽트 처리 루틴에서 인터럽트를 처리한다. 여기에는 인터럽트가 발생한 원인을 파악하고, 필요한 작업을 수행하는 과정이 포함된다.
**5. 원래 프로세스로 복귀**:인터럽트 처리가 완료되면, cpu는 중단했던 프로세스의 상태를 복구하고 원래 수행하던 명령을 이어서 수행한다.

## 중요성

인터럽트는 시스템의 효율적인 운영을 위해 필수적이다. 인터럽트를 통해 cpu는 하드웨어 장치의 요청을 즉각적으로 처리할 수 있으며, 이를 통해 시스템의 반응성을 높일 수 있다. 또한, 인터럽트는 중요한 이벤트를 놓치지 않도록 보장한다.

## 종류

### 1. 하드웨어 인터럽트 (일반적인 인터럽트)

- 하드웨어 컨트롤러가 cpu의 서비스를 요청하기 위해 발생시키는 인터럽트
- 하드웨어 인터럽트 발생과정 사진 참고

### 2. 소프트웨어 인터럽트 (Trap: 트랩)

#### 예외 상황 (Exception)

**정의**: 프로그램이 허용되지 않은 연산을 수행하려 할 때 자동으로 발생하는 상황.
**운영체제 역할**: 예외 상황이 발생하면, 운영체제는 CPU의 제어권을 획득하여 이를 처리한다.
**예시**: 0으로 나누는 연산, 자신의 주소 공간을 넘어서는 메모리 참조 등.
**처리 루틴**: 예외 상황에 대한 처리 루틴을 운영체제의 코드 영역에 가지고 있다.

#### 시스템 콜 (System Call)

**정의**:사용자 프로세스가 운영체제의 서비스를 요청하기 위해 커널의 함수를 호출하는 것.
**필요성**:사용자 프로세스가 직접 특권 명령을 수행할 수 없기 때문에, 특권 명령을 수행하려 할 때, 시스템 콜을 사용한다.

#### 발생 과정

- **제어권 이양**: 시스템 콜이나 예외 상황 모두 사용자 프로세스로부터 cpu 제어권이 운영체제로 이양되어 처리된다.
- **인터럽트 라인 세팅**: 이 과정에서 인터럽트 라인을 세팅하여 인터럽트를 발생시킨 후 제어권이 넘어가므로, 넓은 의미에서 이들도 인터럽트에 포함된다.
- **주체**: 하드웨어 장치가 아닌 소프트웨어가 인터럽트를 발생시키기 때문에, 이를 소포트웨어 인터럽트라고 부른다.

## 인터럽트 발생 처리 과정

프로그램 A가 cpu를 할당받아 명령을 수행하고 있을 때 인터럽트가 발생하면, A는 현재 수행중인 명령의 위치를 저장해놓는다. 이후 운영 체제 내부 코드인 인터럽트 처리 루틴으로 넘어가서 인터럽트를 처리 하고 다시 돌아와 A의 이전 작업 지점부터 수행을 계속 이어나간다.

### 과정)

1. **인터럽트 감지** : cpu가 현재 실행 중인 명령어를 수행하는 도중에 인터럽트 신호를 감지한다.
2. **현재 상태 저장** : CPU는 현재 수행 중인 프로세스 A의 상태를 저장한다. 여기에는 현재 명령어의 주소, CPU 레지스터 상태, 프로그램 카운터 등이 포함된다. 이 정보는 PCB에 저장된다.
3. **인터럽트 벡터 확인** :

- CPU는 `인터렙트 벡터`를 통해 해당 인터럽트에 대한 `인터럽트 서비스 루틴(ISR)`의 주소를 알아낸다.
- `인터럽트 벡터`는 여러 가지 인터럽트에 대해 해당 인터럽트 발생시 처리해야 할 루틴의 주소를 보관하고 있는 테이블이다. 일종의 함수를 가리키는 포인터 역할을 한다.

4. **인터럽트 처리**:

- CPU는 `인터럽트 벡터`에서 얻은 주소로 이동하여 인터럽트 서비스 루틴(ISR)을 실행한다.
- `인터럽트 서비스 루틴`은 실제 인터럽트를 처리하기 위한 코드로, 운영체제 내에 이미 프로그램되어 있다. 이를 `인터럽트 핸들러`라고도 한다.

5. **상태 복원**:

- 인터럽트 처리가 완료되면 CPU는 저장된 PCB에서 이전 상태를 복원한다.
- 프로그램 A의 PCB에 저장된 주소와 레지스터 값을 복원하여 원래 수행하던 작업을 계속 이어나간다.

### 용어)

**인터럽트 벡터(Interrupt Vector)**

- 여러 인터럽트에 대해 해당 인터럽트 발생시 처리해야 할 루틴의 주소를 보관하고 있는 테이블이다. 각 인터럽트 유형마다 고유한 벡터가 있으며, 이는 인터럽트 서비스 루틴(ISR)의 시작 주소를 가리킨다.
- 일종의 함수를 가리키는 포인터.

**인터럽트 핸들러(Interrupt Handler)**

- 인터럽트를 처리하기 위한 루틴으로, 인터럽트 서비스 루틴(ISR)이라고도 한다.
- 운영체제는 각 인터럽트 유형에 대해 적절한 처리 루틴을 미리 정의해두며, 인터럽트가 발생하면 CPU는 해당 인터럽트 핸들러를 실행하여 필요한 작업을 수행한다.

### 예시) 입출력 관련 인터럽트 처리

1. **인터럽트 신호 감지** : CPU는 인터럽트 라인을 통해 입출력 인터럽트 신호를 감지한다.
2. **현재 상태 저장**: 현재 수행 중이던 프로그램 A의 상태를 PCB에 저장한다.
3. **인터럽트 벡터 확인** : CPU는 인터럽트 벡터를 참조하여 입출력 인터럽트에 해당하는 인터럽트 서비스 루틴(ISR)의 메모리 주소를 확인한다.
4. **인터럽트 처리**: 인터럽트 벡터에서 얻은 주소로 이동하여 입출력 인터럽트를 처리하는 ISR을 실행한다. 이 루틴은 입출력 장치와의 데이터 전송, 상태 확인 등의 작업을 수행한다.
5. **상태 복원 및 재개** : 인터럽트 처리가 완료되면, CPU는 PCB에 저장된 이전 상태를 복원하여 프로그램 A의 실행을 재개한다. CPU는 중단된 명령어의 다음 명령어부터 실행을 이어간다.
