## 프로그램

: 어떤 작업을 위해 실행할 수 있는 파일

## 프로세스

### 1. 프로세스의 정의와 메모리 구조

: 실행 중인 프로그램의 인스턴스이고, 디스크에서 메모리로 적재되어 cpu 할당을 받은 작업 단위다.

- 운영체제한테 시스템 자원을 할당받는다.
  - **할당받는 시스템 자원**:
    - **CPU 시간**: 프로세스가 실행되기 위해 할당받는 CPU 시간
    - **주소공간(Address Space)**: 프로세스가 접근할 수 있는 전체 메모리 범위
    - **독립된 메모리 영역**: 프로세스 내에서 코드, 데이터, 스택, 힙과 같은 섹션들로 구성된다.
      - **Code 섹션**: 실행할 코드가 저장되는 영역
      - **Data 섹션**: 전역 변수와 정적 변수가 저장되는 영역
      - **Stack 섹션**: 함수 호출 시 지역 변수, 매개 변수, 리턴 주소 등이 저장되는 영역.
      - **Heap 섹션**: 동적으로 할당되는 메모리 영역
- 프로세스는 각각 별도의 주소공간 가진다. 주소 공간 내에서 독립된 메모리 영역(code, data, stack, heap)이 구성된다.

### 2. 프로세스와 스레드

- 프로세스마다 최소 1개의 스레드를 가지며, 이를 메인 스레드라고 한다.
- 하나의 프로세스는 여러 개의 스레드를 가질 수 있으며, 이들 스레드는 프로세스의 자원을 공유한다.

### 3. 프로세스 간 메모리 접근

- 프로세스는 각각 독립된 메모리 공간을 가지므로, 한 프로세스는 다른 프로세스의 메모리 영역에 직접 접근할 수 없다. (변수나 자료구조에 접근 X)
- 프로세스 간 데이터를 주고 받기 위해서는 IPC(Inter-Process Communication) 통신을 사용해야 한다.
  IPC EX)
- **파이프(Pipes)**:한 프로세스의 출력이 다른 프로세스의 입력으로 연결되는 통신 방식.
- **파일(Files)**: 프로세스 간 데이터를 주고받기 위한 파일 시스템을 통한 통신.
- **소켓(Sockets)**: 네트워크를 통한 프로세스 간 통신 방식.
- **메시지 큐 (Message Queues)**: 메시지를 큐에 저장하고, 다른 프로세스가 이를 읽어가는 방식.
- **공유 메모리(Shared Memory)**: 두 프로세스가 동일한 메모리 영역을 공유하여 데이터를 주고 받는 방식.

## 프로세스 제어 블록 (Process Control Block, PCB)

: 특정 프로세스에 대한 중요한 정보를 저장하고 있는 커널 내의 자료구조다.

- OS는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 `PCB`를 생성한다.
- 프로세스는 **CPU**를 할당받아 작업을 처리하다가 => 프로세스 전환이 발생하면 => 진행하던 작업을 저장하고 **CPU를 반환**한다. => 이때의 작업 진행 상황을 모두 `PCB`에 저장한다. => 다시 **CPU를 할당받게** 되면 `PCB에 저장되었던 내용을 불러와 저장시점부터 다시 작업을 수행한다.`
- PCB에 저장되는 정보:

  - **프로세스 식별자(Process ID, PID)**: 프로세스 식별 번호
  - **프로세스 상태**:프로세스의 현재 상태(new, ready, running, waiting, terminated)
  - **프로그램 카운터(Program Counter, PC)**: 프로세스가 다음에 실행할 명령어의 주소.
  - **CPU 레지스터**:프로세스 실행 중의 레지스터 값들이 저장된다. 프로세스 전환 시 이 값들을 PCB에 저장하고, 재실행 시 복원한다.
  - **CPU 스케줄링 정보**: 프로세스의 우선순위, 스케줄 큐에 대한 포인터 등의 스케줄링 정보를 포함한다. 이 정보는 CPU 스케줄러가 프로세스를 선택할 때 사용된다.
  - **메모리 관리 정보**: 프로세스의 주소 공간을 관리하기 위한 정보로, 페이지 테이블 또는 세그먼트 테이블 등과 같은 메모리 관리 정보.
  - **입출력 상태 정보**: 프로세스에 할당된 입출력 장치들, 열린 파일 목록 등의 정보가 포함된다. 프로세스가 어떤 자원을 사용하고 있는지 관리한다.
  - **어카운팅 정보**: 사용된 CPU 시간, 시간 제한, 계정 번호가 포함된다. 이 정보는 시스템 자원 사용량을 추적하는데 사용된다.

  결론) PCB는 운영체제가 **프로세스를 효율적으로 관리**하고 **문맥 전환을 수행**하는데 중요한 역할을 한다. `PCB에 저장된 정보들은 프로세스가 중단된 시점에서 다시 실행할 수 있도록 필요한 모든 데이터를 포함`하고 있다.

## 스레드 (Thread)

### 개요

- 프로세스의 실행 단위
- 한 프로세스 내에서 여러 실행 흐름을 동시에 수행할 수 있다.
- 스레드를 사용하면 프로세스 내에서 여러 작업을 병렬로 실행 => 자원을 효율적으로 사용한다.

### 주요 특징

- **실행 단위** : 프로세스 내에서 실행되는 개별적인 실행 흐름. 한 프로세스는 여러 스레드를 가질 수 있으며, 각 스레드는 독립적으로 실행된다.
- **자원 공유** : 동일한 프로세스 내의 **주소 공간**과 **자원을 공유**한다. 이는 스레드 간의 "통신"과 "데이터 공유"를 용이하게 한다.

### 공유되는 영역

- **Code 영역**: 프로그램의 코드가 저장된 영역.
- **Data 영역**: 전역 변수와 정적 변수가 저장된 영역.
- **Heap 영역**: 동적으로 할당된 메모리가 저장된 영역.

### 개별 영역

- **레지스터**: 독립적인 레지스터 집합을 가진다. (CPU의 임시 저장소로 사용됨)
- **Stack 영역**: 독립적인 스택을 가진다. (함수 호출과 지역 변수를 저장하는 데 사용됨)

### 장점

**병렬 처리**: 여러 스레드를 사용 => 병렬 처리를 구현 => 성능을 향상
**응답성 향상**: 예를 들어, 긴 작업을 별도의 스레드에서 실행하여 사용자 인터페이스가 계속 반응하도록 할 수 있음.
**자원 효율성**: 스레드는 프로세스 간 통신보다 가벼우며, 같은 프로세스 내에서 자원을 공유하므로 자원을 효율적으로 사용할 수 있음.

### 단점

**복잡성 증가**: 여러 스레드를 **관리**하고 **동기화**하는 것은 프로그래밍을 복잡하게 만든다. 잘못된 동기화는 **교착 상태(데드락)나 경쟁 조건(race condition)** 등의 문제를 일으킬 수 있습니다.
**디버깅 어려움**: 멀티스레드 프로그램은 디버깅이 어렵다. **스레드 간의 상호작용과 타이밍 문제**로 인해 버그를 재현하고 수정하는 것이 까다로울 수 있습니다.

### 요약

스레드는 프로세스 내에서 실행되는 독립적인 실행 단위로, 여러 스레드를 사용하면 병렬 처리와 자원 공유를 통해 성능과 응답성을 향상시킬 수 있습니다. 그러나 스레드 관리와 동기화의 복잡성으로 인해 프로그래밍의 어려움이 증가할 수 있습니다. 스레드는 프로세스의 Code, Data, Heap 영역을 공유하며, 각 스레드는 독립적인 레지스터와 Stack을 가집니다.

### 멀티 프로세스(Multi Process)

: 하나의 응용프로그램을 여러 개의 프로세스로 구성해서, 각 프로세스가 독립적으로 하나의 작업을 처리하도록 하는 방식이다. 각 프로세스는 독립적인 메모리 공간을 가지고, 서로 다른 작업을 수행한다.

**장점)**

- **안전성**: 여러 개의 자식 프로세스 중 하나에 문제가 발생하면, 해당 자식 프로세스만 종료되고 다른 프로세스에는 영향이 미치지 않는다. 이는 시스템의 안정성을 높이는데 기여한다.
- **병렬 처리**: 각 프로세스가 독립적으로 실행되므로, 멀티 코어 시스템에서 병렬처리가 가능해져 성능이 향상될 수 있다.

**단점)**

- **Context Switching에서의 오버헤드** :
  프로세스는 독립된 메모리 영역을 가지므로, 프로세스 간 문맥 전환시 캐시 메모리 초기화 등 무거운 작업이 발생하여 많은 시간이 소모될 수 있다.
- **프로세스 간 통신 기법 IPC**:
  프로세스는 독립된 메모리 영역을 가지므로, 변수나 자료구조를 공유할 수 없다. 따라서 IPC를 사용해야하고, 복잡한 구현이 어려운 통신 방법이다.

**추가 설명**

- **Context Switching**: 운영 체제가 CPU를 다른 프로세스에 할당하기 위해 현재 실행 중인 프로세스의 상태(Context)를 저장하고, 다음 실행할 프로세스의 상태를 복원하는 작업입니다. 이 과정은 CPU 자원을 소모하고, 캐시를 초기화해야 하기 때문에 오버헤드가 발생합니다.
- **IPC (Inter-Process Communication)**: 프로세스 간 데이터를 주고받는 방법으로, 여러 기법이 있습니다. 대표적인 IPC 기법으로는 파이프(pipe), 메세지 큐(message queue), 공유 메모리(shared memory), 소켓(socket) 등이 있습니다. 각 기법은 구현과 사용 방법이 다르며, 데이터의 양과 통신의 복잡성에 따라 적절한 방법을 선택해야 합니다.

### 멀티 스레드(Multi Thread)

: 하나의 응용 프로그램을 여러 개의 스레드로 구성하여 각 스레드가 개별 작업을 처리하도록 하는 것이다.

- 윈도우, 리눅스 등 대부분의 운영체제가 멀티 프로세싱을 지원하지만, 멀티 스레딩을 기본으로 한다.
- 웹 서버는 대표적인 멀티 스레드 응용 프로그램이다.

**장점)**

- **자원 소모 절감**: 메모리 공간과 시스템 자원을 절약할 수 있다.
- **간단한 통신 방법**: 스레드 간 통신은 전역변수나 동적으로 할당된 Heap 영역을 통해 이루어지므로 비교적 간단하다.
- **비용 절감 및 속도 향상**: Context Switching 시, 캐시 메모리를 비울 필요가 없기 때문에 비용이 적고, 더 빠르다.
- **처리량 향상**: 이러한 장점으로 인해 시스템의 처리량이 향상되고, 자원 소모가 줄어들어 프로그램의 응답 시간이 단축된다.

**단점)**

- **자원 공유 문제**: 여러 스레드가 Data, Heap 영역 등을 공유하기 때문에 동기화 문제가 발생할 수 있다. 특정 스레드가 다른 스레드에서 사용중인 변수나 자료구조에 접근하여 잘못된 값을 읽거나 수정할 수 있다.
- **자원 프로세스 영향**:하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.
- **설계와 디버깅의 어려움**:주의 깊은 설계가 필요하며, 디버깅이 까다롭다.

## 멀티 프로세스 vs 멀티 스레드

멀티 스레드는 멀티 프로세스보다 적은 메모리 공간을 차지하고 Context Switching이 빠르다는 장점이 있찌만, 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다는 점과 동기화 문제를 가지고 있다.

반면, 멀티 프로세싱 방식은 하나의 프로세스가 죽더라도 다른 프로세스에는 영향을 끼치지 않고 정상적으로 수행된다는 장점이 있지만, 멀티 스레드보다 많은 메모리 공간과 CPU 시간을 차지한다는 단점이 존재한다.

이 두가지는 동시에 여러 작업을 수행한다는 점에서 같지만 적용해야 하는 시스템에 따라 적합/부적합이 구분된다. 따라서 대상 시스템의 특징에 따라 적합한 동작 방식을 선택하고 적용해야 한다.

### 멀티 프로세싱이 적합한 시스템

- **안정성 요구 시스템**: 한 프로세스의 오류가 전체 시스템에 영향을 주지 않도록 해야 하는 경우, 예를 들어 서버 애플리케이션이나 중요 데이터 처리 시스템.
- **고성능 컴퓨팅**: 병렬 처리 능력을 최대화해야 하는 과학 계산, 데이터 분석 등 고성능 컴퓨팅 환경.
- **독립적인 작업**: 서로 독립적인 작업을 수행하는 애플리케이션, 예를 들어 다중 사용자 지원 웹 서버나 데이터베이스 서버.
- **보안 요구 시스템**: 각 작업이 독립된 메모리 공간을 사용하여 다른 작업의 메모리 영역에 접근할 수 없는 환경, 예를 들어 금융 시스템이나 비즈니스 크리티컬 애플리케이션.

### 멀티 스레딩이 적합한 시스템

- **빠른 응답성 요구 시스템**: 빠른 응답성이 중요한 사용자 인터페이스(UI) 애플리케이션, 예를 들어 웹 브라우저나 게임.
- **경량 작업**: 메모리 사용이 적고 Context Switching 비용이 낮아야 하는 경량 작업, 예를 들어 채팅 애플리케이션이나 실시간 데이터 피드.
- **공유 메모리 사용**: 스레드 간 데이터 공유가 빈번하고 효율적인 통신이 필요한 경우, 예를 들어 그래픽 렌더링 엔진이나 시뮬레이션 프로그램.
- **IO 바운드 작업**: I/O 작업이 빈번한 경우, 예를 들어 파일 시스템 조작이나 네트워크 통신 애플리케이션.
  **정리**
  멀티 프로세싱과 멀티 스레딩은 각기 다른 특성과 장단점을 가지므로, 시스템의 요구 사항과 특성에 따라 적합한 방식을 선택해야 합니다. 안정성과 독립성이 중요할 때는 멀티 프로세싱을, 빠른 응답성과 메모리 효율성이 중요할 때는 멀티 스레딩을 사용하는 것이 좋습니다.

### 자주 나오는 질문

**Q. 스택을 스레드마다 독립적으로 할당하는 이유는 뭘까?**
A: 스택은 함수 호출시 전달되는 인자, 복귀 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간입니다.

스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 뜻이고, 이는 독립적인 실행 흐름이 추가된다는 것입니다. 따라서 스레드의 정의에 따라 독립적인 실행흐름을 추가하기 위한 최소 조건으로 독립된 스택을 할당하는 것입니다.

**Q: PC 레지스터를 스레드마다 독립적으로 할당하는 이유는 뭘까?**
A: PC 레지스터는 현재 실행 중인 명령어의 주소를 가리키는 역할을 합니다. 각 스레드는 CPU를 할당받았다가 스케줄러에 의해 다시 선점당합니다. 그렇기 때문에 명령어가 연속적으로 수행되지 못하고 어느 부분까지 수행했는지 기억할 필요가 있습니다. 따라서 스레드마다 PC 레지스터를 독립적으로 할당합니다.

**Q.멀티 프로세스 대신 멀티 스레드를 사용하는 이유는?**
A:

- 프로그램을 여러개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이 더욱 효율적이기 때문입니다.
- 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있습니다.
- Context Switching시,스레드는 stack 영역만 초기화하면 되기 때문에, 캐시 메모리를 비울 필요가 없어 비용이 적고 빠릅니다.
- 스레드는 프로세스의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 데이터 전달이 간단하므로 IPC에 비해 비용이 적고 더 빠릅니다.

**Q.Context Switching이란?**

- cpu는 한번에 하나의 process만 처리할 수 있다.
- 여러 프로세스를 처리해야 하는 상황에서 현재 진행
