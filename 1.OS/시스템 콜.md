# 시스템 콜(System Call)

## 커널모드, 사용자 모드

먼저 커널모드와 사용자 모드에 대해 알아보자.

### 커널 모드

- 커널 모드는 cpu가 운영체제의 코드를 수행하는 상태를 말한다.
- 프로그램 카운터가 운영체제가 위치한 부분을 가리킬 때, cpu는 커널 모드에서 동작 중이다.
- 이 모드에서는 운영체제의 핵심 기능을 실행하며, 하드웨어 자원에 직접 접근할 수 있다.

### 사용자모드

- 사용자 모드는 cpu가 사용자 프로그램의 코드를 수행하는 상태를 말한다.
- 프로그램 카운터가 사용자 프로그램이 존재하는 메모리 위치를 가리킬 때, cpu는 사요자 모드에서 동작 중이다.

#### 명령 유형

- **일반 명령**: 메모리에서 자료를 읽어와 cpu에서 계산하고 결과를 메모리에 쓰는 일련의 명령들로, 모든 프로그램이 수행할 수 있다. 이러한 명령은 사용자 모드에서 실행된다.
- **특권 명령**: 보안이 필요한 명령으로, 입출력 장치, 타이머 등 각종 장치에 접근하는 명령이다. 이러한 명령은 커널 모드에서만 실행할 수 있다.

#### 모드 비트

- cpu 내에 mode bit를 두어, 일반 명령과 특권 명령을 구분하여 수행한다.

#### 시스템 콜

사용자 프로그램이 디스크의 파일을 접근하거나, 화면에 결과를 출력하는 등의 작업을 수행할 때는 특권 명령이 필요하다. 그러나 사용자 프로그램은 특권 명령을 수행할 수 없으므로, 운영체제에게 특권 명령의 대행을 요청하게 된다. 이러한 서비스 요청을 `시스템 콜`이라고 한다. 시스템 콜을 통해 사용자 프로그램은 커널 영역의 기능을 수행할 수 있게 된다.

## 디스크에서 자료를 읽어오는 시스템 콜이라고 가정할 때,

1.**시스템 콜 요청**: 사용자 프로그램이 디스크에서 자료를 읽어오는 시스템 콜을 요청한다. 이때 운영체제는 커널 영역에 정의된 시스템 콜 처리 코드를 수행한다. 2. **디스크 읽기 명령**: cpu가 컨트롤 레지스터를 설정하여 디스크 컨트롤러에게 데이터를 읽어오라고 명령한다. 3. **데이터 읽기**:디스크 컨트롤러는 디스크로부터 데이터를 읽어와 자신의 로컬 버퍼에 저장한다. 4. **작업 완료 통지**: 디스크 컨트롤러가 데이터 읽기 작업을 완료하면, cpu에게 인터럽트를 발생시켜 입출력 작업이 완료되었음을 알린다.

## 시스템 콜, 여러 종류의 기능

시스템 콜은 다양한 기능으로 나뉘어져 있다. 각 시스템 콜에는 번호가 할당되며, 시스템 콜 인터페이스는 이러한 번호를 인덱스로 사용하는 테이블을 유지한다. 아래 그림은 open() 시스템 콜을 호출될 때 운영체제는 다음과 같은 방식으로 이를 처리한다.

## 시스템 콜 발생 때, 추가적인 정보 전달 방법

시스템 콜이 발생할 때, 필요한 기능이나 시스템 환경에 따라 추가적인 정보가 필요할 수 있다. 이러한 정보를 운영체제에 전달하는 방법은 3가지가 있다.

1. **cpu 레지스터 사용**:매개변수를 cpu 레지스터 내에 전달한다. 하지만, 매개변수의 개수가 cpu 레지스터 개수보다 많을 경우에는 제한이 있다.

2. **메모리 사용**: 매개변수를 메모리에 저장하고, 그 메모리의 주소를 레지스터에 전달한다.(그림 참고)

3. **스택 사용**: 매개변수를 프로그램에 의해 스택으로 전달할 수도 있다.

=> 2번, 3번 방법은 전달되는 **매개변수의 개수나 길이에 제한이 없기 때문에** 몇몇 운영체제에서 선호하는 방식이다.

## 시스템 콜의 유형

시스템 콜은 운영체제가 제공하는 다양한 기능을 애플리케이션이 사용할 수 있게 하는 인터페이스다.

1.**프로세스 제어** : 프로세스 특권 모드를 사용해 직접적으로 프로세스를 제어한다. 2.**파일 조작**: 파일을 생성하거나 삭제, 관리 등을 수행한다. 3.**장치 관리**: 장치 요구 및 해제, 읽기, 쓰기, 재배치 등의 작업을 처리한다. 4.**정보 유지**: 시간과 날짜 설정 및 획득, 시스템 자료의 설정과 획득을 담당한다. 5.**통신**: 통신 연결의 생성 및 제거, 메시지의 송수신, 상태 정보 전달 등을 수행한다.
